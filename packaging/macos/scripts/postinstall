#!/bin/sh
set -e

console_user="${SUDO_USER:-}"
if [ -z "${console_user}" ] || [ "${console_user}" = "root" ]; then
  console_user="$(stat -f%Su /dev/console 2>/dev/null || true)"
fi

if [ -n "${console_user}" ] && [ "${console_user}" != "root" ]; then
  user_home="$(dscl . -read "/Users/${console_user}" NFSHomeDirectory 2>/dev/null | awk '{print $2}')"
  if [ -n "${user_home}" ]; then
    data_dir="${user_home}/Library/Application Support/TodoistAssistant"
    mkdir -p "${data_dir}"
    chown "${console_user}":staff "${data_dir}" || true
  fi
fi

exit 0
